#!/bin/bash
apt-get update && apt-get install -y wget unzip curl gnupg jq fonts-liberation libappindicator3-1 xdg-utils libasound2 libatk-bridge2.0-0 libatk1.0-0 libcups2 libdbus-1-3 libgdk-pixbuf2.0-0 libnspr4 libnss3 libx11-xcb1 libxcomposite1 libxdamage1 libxrandr2 libgbm1 libxshmfence1 libpango-1.0-0 libpangocairo-1.0-0 libatspi2.0-0 ca-certificates && curl -sSL https://googlechromelabs.github.io/chrome-for-testing/last-known-good-versions-with-downloads.json | jq -r '.channels.Stable.version' | xargs -I {} sh -c 'wget -q https://storage.googleapis.com/chrome-for-testing-public/{}/linux64/chrome-linux64.zip && wget -q https://storage.googleapis.com/chrome-for-testing-public/{}/linux64/chromedriver-linux64.zip && unzip chrome-linux64.zip && unzip chromedriver-linux64.zip && mv chrome-linux64 /home/site/wwwroot/bin/chrome && mv chromedriver-linux64/chromedriver /home/site/wwwroot/bin/chromedriver && chmod +x /home/site/wwwroot/bin/chromedriver && ln -s /home/site/wwwroot/bin/chrome/chrome /home/site/wwwroot/bin/chromium' && gunicorn -w 1 -k uvicorn.workers.UvicornWorker main:app --timeout 1790
